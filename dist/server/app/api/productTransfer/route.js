(()=>{var e={};e.id=139,e.ids=[139],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2172:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>c,POST:()=>d});var a=r(8797),o=r(42),n=r(8492),u=r(3524),i=r(9540);let p=new u.PrismaClient;async function c(e,t){try{let e=await p.productTransferList.findMany();return i.NextResponse.json({status:"ok",data:e})}catch(e){return console.log(e.message),i.NextResponse.json({status:500,error:"Failed to get all categories!"})}}async function d(e,t){try{let{selectedProduct:t,category:r,subCategory:s,perPacket:a,totalpacket:o,quantity:n,customer_id:u,note:c}=await e.json(),d=JSON.parse(t),l={id:Number(d?.id),name:d?.name},f=await p.products.findFirst({where:{id:Number(d?.id)}});if(!f)return console.error("Product not found"),i.NextResponse.json({status:404,error:"Product not found"});if(await p.products.count({where:l}),f.quantity<n)return console.error("Insufficient product quantity"),i.NextResponse.json({error:"Insufficient product quantity"},{status:400});let x=await p.$transaction(async e=>{let t={productName:d?.name,product_id:d?.id,category:r,subCategory:s,quantity:n?parseFloat(n):null,perPacket:a?parseFloat(a):null,totalpacket:o?parseFloat(o):null,note:c||f.note},u=await e.productTransferList.create({data:t});return await e.products.update({where:{id:f.id},data:{quantity:f.quantity-n}}),u});return i.NextResponse.json({status:"ok",data:x},{status:201})}catch(e){return console.error("Error creating sale:",e.message),i.NextResponse.json({error:"Failed to create sale"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/productTransfer/route",pathname:"/api/productTransfer",filename:"route",bundlePath:"app/api/productTransfer/route"},resolvedPagePath:"H:\\Apps-key\\milon-store-sharif-backend\\src\\app\\api\\productTransfer\\route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:x,serverHooks:m}=l;function y(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:x})}},8031:()=>{},5303:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[492,661],()=>r(2172));module.exports=s})();